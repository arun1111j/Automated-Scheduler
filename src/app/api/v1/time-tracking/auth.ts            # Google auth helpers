import { OAuth2Client } from 'google-auth-library';
import { NextApiRequest, NextApiResponse } from 'next';

const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);

export const verifyGoogleToken = async (token: string) => {
    const ticket = await client.verifyIdToken({
        idToken: token,
        audience: process.env.GOOGLE_CLIENT_ID,
    });
    const payload = ticket.getPayload();
    return payload;
};

export const authenticateUser = async (req: NextApiRequest, res: NextApiResponse) => {
    const { token } = req.body;

    if (!token) {
        return res.status(400).json({ error: 'Token is required' });
    }

    try {
        const user = await verifyGoogleToken(token);
        // Here you can handle user session creation or database storage
        return res.status(200).json({ user });
    } catch (error) {
        return res.status(401).json({ error: 'Invalid token' });
    }
};